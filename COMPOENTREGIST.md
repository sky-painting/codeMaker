# 组件注册流程
## 说明
本次版本迭代主要涉及组件化架构升级，因此这里需要说明一下如何注册并引入组件的过程，以下是操作过程。因为时间的关系没有用流程图来表达，后续补充上。

## 注册步骤
### 注册框架级组件(dubbo)
当前codemaker-core默认的框架级组件支持dubbo和spring-web，开发者可以基于此进行二次开发来适配自己的技术栈

1. 在codemaker-core/src/main/resources/component目录下新建组件名称目录如dubbo
2. 创建组件属性文件如dubbo.properties文件
3. 文件内容如下：
```
#Generated by Maven
#Fri Sep 20 00:50:48 CST 2019
version=2.7.3
groupId=org.apache.dubbo
artifactId=dubbo
packageName=org.apache.dubbo.config.annotation
compSite=https://dubbo.apache.org/zh/
compDesc=Apache Dubbo是一款分布式RPC框架(就是组件描述)
annotation1=Service
annotation2=Reference
```
4. 由于是框架级组件，codeMaker对框架级组件的定位为应用工程生成依赖的底座，所以需要在
codemaker-apiImpl工程下实现对应的组件扫描和代码装饰过程，参考dubbo实现

5. 在codemaker-core的application.properties文件中配置框架级扫描和装饰bean实现,已有默认实现

6. 在对应的projecttemplate-dubbo.properties文件或者projecttemplate-cola.properties文件
配置组件依赖

### 注册应用工具包级组件(hutool-core或者infosysuser)
这里的hutool-core是工具类级别的封装jar包,infosysuser是infosysauth依赖的用户组件api

1. 在codemaker-core/src/main/resources/component目录下新建组件名称目录如hutool-core或者infosysuser

2. 创建对应的组件属性文件如hutool-core.properties文件
3. 文件内容如下：
```
#Generated by Maven
#Fri Sep 20 00:50:48 CST 2019
version=5.3.10
groupId=cn.hutool
artifactId=hutool-core
serviceName=hutool
packageName=cn.hutool.core.map
compType=tool
compSite=https://www.hutool.cn/
compDesc=一款工具包
```
4. 这里需要说明的是对于应用级组件来说不需要自己实现组件扫描和装饰,对于应用级组件的定位是在渲染调用时序图的时候会扫描依赖到的组件服务
并自动引入，独立工具类或者封装工具类组件也一样。当然如果需要这个应用组件对某个代码元素做统一的装饰
比如mybatis-plus的数据模型注解，swagger-api注解等等，那可以将这个组件定位为框架级组件。

### 注册独立工具类或者封装类级组件(AppEventPublisher)

这里的独立工具类组件或者封装类组件其实比较广泛，可以理解为只要是工具类或者基于某框架封装的工具操作类都可以注册
区别就是这里的独立工具类不是一个jar包，而上面的组件是一个jar或者多个jar.

1. 在codemaker-core/src/main/resources/component目录下找到singleClass文件夹
2. 创建对应的组件属性文件如AppEventPublisher.properties文件
3. 文件内容如下：
```
packageName=${package}.domain.support.utils
classType=class
method1=void publish(T t)
```
4. 由于独立类组件比较多也比较丰富，这里就单独列了一个singleClass文件夹来存放所有的独立类配置，因此独立类配置在
codeMaker中是自动注册的不需要开发者显示注册，后续可以在各自的组件文件夹中存放基于本组件封装的工具类。

### 把独立工具类或者封装的工具类复制到项目里(如AppEventPublisher)

这里的独立工具类或者封装的工具类与上面的不同之处在于项目可能只会引用但是不会复制到自己项目里，另外一种就是我既需要
引用也需要复制。比如项目初始化的时候需要依赖很多自己封装的或者别的项目里有的工具类，用着顺手。

那这种场景就需要把独立类注册为ftl模板，注册步骤如下：
1. 在codemaker-core/src/main/resources/template目录下找到singleClass文件夹
2. 创建对应的独立工具类ftl文件模板，如AppEventPublisher.ftl
3. 将独立工具类整体内容复制到文件模板中
4. 修改独立类的所属包名,如(package ${package}.domain.support.utils)
5. 在对应的projecttemplate-applicationType.properties配置文件中配置需要初始化的组件(参考配置格式)


### 在调用过程中显示注册引用包(如JDK的常用类)

由于codeMaker在使用plantUMl进行绘制的时候有些场景需要依赖JDK等封装的类，做包引用，因此这里做了一个配置文件
是codemaker-core/src/main/resources/class-import.properties文件
这个文件主要用于进行快速的类-包引用，内容如下：
```
ResultDataDto=com.coderman.utils.response.ResultDataDto
ResultDto=com.coderman.utils.response.ResultDto
PageDTO=com.coderman.utils.response.PageDTO
PageVO=com.coderman.utils.response.PageVO
```
上面的包内容也可以是JDK的其他工具类如LinkedList,当plantUML中定义了特定的类需要引入的时候就可以借助这个方式，降低手动引入
或者idea自动引入带来的潜在修改麻烦。

